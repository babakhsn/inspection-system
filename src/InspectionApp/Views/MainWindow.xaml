<Window x:Class="InspectionApp.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:InspectionApp.ViewModels"
        xmlns:p="clr-namespace:InspectionCore.Processing;assembly=InspectionCore"
        Title="InspectionApp" Height="800" Width="600">
    <!--<Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>-->


    <DockPanel LastChildFill="True">
        <!-- Top Bar -->
        <Border DockPanel.Dock="Top" Padding="12" Background="#F5F5F7" BorderBrush="#E5E5EA" BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="{Binding Title}" FontSize="20" FontWeight="SemiBold" Margin="0,0,16,0"/>
                <Separator Width="1" Height="20" Margin="8,0" />
                <TextBlock Text="Shell" Opacity="0.7" VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Status Bar -->
        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" />
            </StatusBarItem>
            <Separator />
            <StatusBarItem>
                <TextBlock>
                    <Run Text="Last action:"/>
                    <Run Text="{Binding LastAction, StringFormat=' {0:HH:mm:ss}'}"/>
                </TextBlock>
            </StatusBarItem>
        </StatusBar>

        <!-- Main Content -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="240"/>
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Controls Panel -->
            <Border Grid.Column="0" Padding="12" BorderBrush="#E5E5EA" BorderThickness="0,0,1,0" Background="White">
                <StackPanel>
                    <TextBlock Text="Controls" FontWeight="SemiBold" Margin="0,0,0,8"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="Start Capture"
                                Command="{Binding StartCaptureCommand}"
                                Width="110" Margin="0,0,8,0"/>
                        <Button Content="Stop"
                                Command="{Binding StopCaptureCommand}"
                                Width="80"/>
                    </StackPanel>
                    <Button Content="Save Frame"
                        Command="{Binding CaptureFrameCommand}"
                        ToolTip="Save current frame to disk"/>

                    <TextBlock Text="Filter" FontWeight="SemiBold" Margin="0,12,0,4"/>
                    <ComboBox SelectedValue="{Binding SelectedFilter}"
                            SelectedValuePath="Tag"
                            DisplayMemberPath="Content">
                        <ComboBoxItem Content="None"          Tag="{x:Static p:FilterType.None}" />
                        <ComboBoxItem Content="Grayscale"     Tag="{x:Static p:FilterType.Grayscale}" />
                        <ComboBoxItem Content="Edge Detection" Tag="{x:Static p:FilterType.EdgeDetection}" />
                        <ComboBoxItem Content="Defect Detection" Tag="{x:Static p:FilterType.DefectDetection}" />
                    </ComboBox>

                    <TextBlock Text="Motor Simulation" FontWeight="SemiBold" Margin="0,16,0,6"/>
                    <TextBlock Text="Pan X (%)" Margin="0,4,0,2"/>
                    <Slider Minimum="-100" Maximum="100"
                        Value="{Binding PanXPercent}"
                        TickFrequency="10" IsSnapToTickEnabled="False"/>

                    <TextBlock Text="Pan Y (%)" Margin="0,8,0,2"/>
                    <Slider Minimum="-100" Maximum="100"
                        Value="{Binding PanYPercent}"
                        TickFrequency="10" IsSnapToTickEnabled="False"/>

                    <TextBlock Text="Zoom (x)" Margin="0,8,0,2"/>
                    <Slider Minimum="1" Maximum="4"
                        Value="{Binding ZoomFactor}"
                        TickFrequency="0.1" IsSnapToTickEnabled="False"/>

                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                        <Button Content="Reset"
                            Command="{Binding ResetMotorCommand}" Width="80"/>
                    </StackPanel>

                    <!-- Edge Detection parameters -->
                    <StackPanel Margin="0,8,0,0">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectedFilter}" Value="{x:Static p:FilterType.DefectDetection}">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding SelectedFilter}" Value="{x:Static p:FilterType.EdgeDetection}">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding SelectedFilter}" Value="{x:Static p:FilterType.Grayscale}">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding SelectedFilter}" Value="{x:Static p:FilterType.None}">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <TextBlock Text="Defect Detection Settings" FontWeight="SemiBold" Margin="0,4,0,6"/>
                        <TextBlock Text="Tip: Thin scratches show after thresholding &amp; slight dilation." Opacity="0.7" FontSize="11"/>
                        <TextBlock Text="Canny Threshold 1" Margin="0,4,0,2"/>
                        <Slider Minimum="0" Maximum="255"
            Value="{Binding CannyThreshold1}" TickFrequency="5" IsSnapToTickEnabled="True"/>

                        <TextBlock Text="Canny Threshold 2" Margin="0,8,0,2"/>
                        <Slider Minimum="0" Maximum="255"
            Value="{Binding CannyThreshold2}" TickFrequency="5" IsSnapToTickEnabled="True"/>
                    </StackPanel>


                    <TextBlock Text="Save Folder" Margin="0,12,0,4" />
                    <TextBox Text="{Binding CaptureDirectory, UpdateSourceTrigger=PropertyChanged}" />

                    <!-- Future placeholders (disabled for now to show intent/consistency) -->
                    <TextBlock Text="Filter (Coming Day 6)" Margin="0,12,0,4" Opacity="0.6"/>
                    <ComboBox IsEnabled="False" />
                    <TextBlock Text="Motor (Coming Day 8)" Margin="0,12,0,4" Opacity="0.6"/>
                    <Slider Minimum="0" Maximum="100" IsEnabled="False"/>
                </StackPanel>
            </Border>

            <!-- Camera Placeholder -->
            <!-- Right Preview Panel -->
            <Border Grid.Column="1" Margin="12"
        Background="#FAFAFB" CornerRadius="8"
        BorderBrush="#E5E5EA" BorderThickness="1"
        Padding="12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- RAW -->
                    <DockPanel Grid.Column="0" LastChildFill="True" Margin="0,0,6,0">
                        <TextBlock DockPanel.Dock="Top" Text="Raw" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <Grid>
                            <Image Source="{Binding OriginalFrame}" Stretch="Uniform"/>
                            <TextBlock Text="No signal" HorizontalAlignment="Center" VerticalAlignment="Center" Opacity="0.4"
                           Visibility="{Binding OriginalFrame, Converter={StaticResource NullToVisibilityConverter}}"/>
                        </Grid>
                    </DockPanel>

                    <!-- PROCESSED -->
                    <DockPanel Grid.Column="1" LastChildFill="True" Margin="6,0,0,0">
                        <TextBlock DockPanel.Dock="Top" Text="Processed" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <Grid>
                            <Image Source="{Binding ProcessedFrame}" Stretch="Uniform"/>
                            <TextBlock Text="No signal" HorizontalAlignment="Center" VerticalAlignment="Center" Opacity="0.4"
                           Visibility="{Binding ProcessedFrame, Converter={StaticResource NullToVisibilityConverter}}"/>
                        </Grid>
                    </DockPanel>
                </Grid>
            </Border>

        </Grid>
    </DockPanel>
    <!--<Grid>
        <TextBlock Text="{Binding Title}" 
                   HorizontalAlignment="Center" 
                   VerticalAlignment="Center" 
                   FontSize="20"/>
    </Grid>-->
</Window>
